<div class="grid">
  <%= render Components::Backend::Card.new(title: "dashboard") do %>
    <div class="section">
      <div class="section-header">
        <h3>verification stats</h3>
        <%= form_tag backend_dashboard_path, method: :get do %>
          <%= select_tag :time_period,
              options_for_select([
                ["today", "today"],
                ["this month", "this_month"],
                ["all time", "all_time"]
              ], @time_period),
              onchange: "this.form.submit()" %>
        <% end %>
      </div>
      <div class="section-content">
        <div class="stats-grid">
          <div class="stat">
            <div class="stat-value"><%= @stats[:total] %></div>
            <div class="stat-label">total</div>
          </div>
          <div class="stat">
            <div class="stat-value" style="color: var(--color-green-50);"><%= @stats[:approved] %></div>
            <div class="stat-label">approved</div>
          </div>
          <div class="stat">
            <div class="stat-value" style="color: var(--color-red-50);"><%= @stats[:rejected] %></div>
            <div class="stat-label">rejected</div>
          </div>
          <div class="stat">
            <div class="stat-value" style="color: var(--color-daybreak);"><%= @stats[:pending] %></div>
            <div class="stat-label">pending</div>
          </div>
          <div class="stat">
            <div class="stat-value"><%= distance_of_time_in_words 0, (@stats[:average_hangtime] || 0) %></div>
            <div class="stat-label">avg wait</div>
          </div>
        </div>
      </div>
    </div>
    <hr/>
    <div class="two-col">
      <div class="section">
        <div class="section-header"><h3>üèÜ leaderboard</h3></div>
        <div class="section-content">
          <% if @leaderboard.any? %>
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>user</th>
                  <th>processed</th>
                </tr>
              </thead>
              <tbody>
                <% @leaderboard.each_with_index do |entry, index| %>
                  <tr>
                    <td><%= index == 0 ? "ü•á" : index == 1 ? "ü•à" : index + 1 %></td>
                    <td><%= render entry[:user] %></td>
                    <td><b><%= entry[:processed_count] %></b></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <div class="empty-state">no activity yet</div>
          <% end %>
        </div>
      </div>
      <div class="section">
        <div class="section-header"><h3>üìä rejection reasons</h3></div>
        <div class="section-content">
          <% if @rejection_breakdown.any? %>
            <table>
              <thead>
                <tr>
                  <th>reason</th>
                  <th>count</th>
                  <th>%</th>
                </tr>
              </thead>
              <tbody>
                <% total_rejected = @stats[:rejected] %>
                <% @rejection_breakdown.each do |reason, data| %>
                  <tr>
                    <td>
                      <%= reason %>
                      <% if data[:fatal] %>
                        <span class="badge danger">fatal</span>
                      <% end %>
                    </td>
                    <td><b><%= data[:count] %></b></td>
                    <td><%= total_rejected > 0 ? "#{(data[:count].to_f / total_rejected * 100).round(1)}%" : "0%" %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          <% else %>
            <div class="empty-state">no rejections</div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>
