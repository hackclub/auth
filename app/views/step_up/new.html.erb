<div style="max-width: 600px; margin: 4rem auto; padding: 0 1rem;">
  <div class="auth-card">
    <% method = params[:method]&.to_sym %>

    <% if method.nil? %>
      <%# Show method selection %>
      <header>
        <h1>Gotta confirm it's you...</h1>
        <small>Choose a verification method to continue</small>
      </header>

      <div style="display: flex; flex-direction: column; gap: 1rem; margin: 2rem 0;">
        <% if @available_methods.include?(:totp) %>
          <%= link_to new_step_up_path(action_type: @action, method: :totp),
              class: "step-up-method-option" do %>
            <div style="font-size: 2rem;">üîê</div>
            <div style="flex: 1;">
              <div style="font-weight: 600;">Authenticator App</div>
              <small>Use your TOTP authenticator app</small>
            </div>
          <% end %>
        <% end %>

        <% if @available_methods.include?(:backup_code) %>
          <%= link_to new_step_up_path(action_type: @action, method: :backup_code),
              class: "step-up-method-option" do %>
            <div style="font-size: 2rem;">üîë</div>
            <div style="flex: 1;">
              <div style="font-weight: 600;">Backup Code</div>
              <small>Use one of your backup codes</small>
            </div>
          <% end %>
        <% end %>

        <% if @available_methods.include?(:sms) %>
          <%= link_to new_step_up_path(action_type: @action, method: :sms),
              class: "step-up-method-option" do %>
            <div style="font-size: 2rem;">üì±</div>
            <div style="flex: 1;">
              <div style="font-weight: 600;">SMS</div>
              <small>Receive a code via text message</small>
            </div>
          <% end %>
        <% end %>
      </div>

      <style>
        .step-up-method-option {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          border: 1px solid var(--border-color);
          border-radius: 8px;
          text-decoration: none;
          color: inherit;
          transition: all 0.2s;
        }
        .step-up-method-option:hover {
          border-color: var(--primary-color);
          background-color: var(--bg-secondary);
        }
      </style>

      <footer>
        <p><%= link_to "Cancel", security_path %></p>
      </footer>

    <% else %>
      <%# Show form for selected method %>
      <header>
        <h1>
          <% case method
             when :totp %>Enter authenticator code
          <% when :backup_code %>Enter backup code
          <% when :sms %>Enter SMS code
          <% end %>
        </h1>
        <small>
          <% case method
             when :totp %>Enter the 6-digit code from your authenticator app
          <% when :backup_code %>Enter one of your backup codes
          <% when :sms %>Enter the code sent to your phone
          <% end %>
        </small>
      </header>

      <%= form_with url: verify_step_up_path, method: :post, local: true do |f| %>
        <%= f.hidden_field :action_type, value: @action %>
        <%= f.hidden_field :method, value: method %>

        <fieldset>
          <%= f.label :code, "Enter code" %>
          <% if method == :backup_code %>
            <%= f.text_field :code,
                required: true,
                autocomplete: "one-time-code",
                autofocus: true,
                placeholder: "XXXXXXXXXX" %>
          <% else %>
            <%= f.text_field :code,
                required: true,
                autocomplete: "one-time-code",
                autofocus: true,
                placeholder: "000000",
                maxlength: 6,
                inputmode: "numeric",
                pattern: "[0-9]{6}" %>
          <% end %>
        </fieldset>

        <%= f.submit "Verify ‚Üí" %>
      <% end %>

      <footer>
        <p><%= link_to "Use a different method", new_step_up_path(action_type: @action) %></p>
      </footer>
    <% end %>
  </div>
</div>
