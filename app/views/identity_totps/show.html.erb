<div class="totp-setup-verify">
  <div class="qr-code-section">
    <p><%= t(".scan_qr") %></p>
    <%= render_qr_code(@totp.provisioning_uri) %>
    
    <details>
      <summary><%= t(".manual_entry") %></summary>
      <code><%= @totp.secret %></code>
    </details>
  </div>

  <%= form_with url: verify_identity_totp_path(@totp), method: :post, data: {
    "hx-post": verify_identity_totp_path(@totp),
    "hx-target": "#totp-container",
    "hx-swap": "innerHTML"
  } do |f| %>
    <%= f.label :code, t(".code_label") %>
    <%= f.text_field :code, 
        required: true, 
        autocomplete: "one-time-code",
        inputmode: "numeric",
        pattern: "[0-9]{6}",
        maxlength: 6,
        placeholder: "000000",
        autofocus: true %>

    <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
      <%= f.submit t(".verify_enable") %>
      <button type="button" 
              class="secondary"
              hx-delete="<%= identity_totp_path(@totp) %>"
              hx-target="#totp-container"
              hx-swap="innerHTML"
              hx-confirm="<%= t('.cancel_confirm') %>">
        <%= t(".cancel") %>
      </button>
    </div>
  <% end %>
</div>
