<div class="totp-setup-verify">
  <div class="qr-code-section">
    <p>Scan this QR code with your authenticator app</p>
    <%= render_qr_code(@totp.provisioning_uri) %>
    
    <details>
      <summary>Can't scan? Enter manually</summary>
      <code><%= @totp.secret %></code>
    </details>
  </div>

  <%= form_with url: verify_identity_totp_path(@totp), method: :post, data: {
    "hx-post": verify_identity_totp_path(@totp),
    "hx-target": "#totp-container",
    "hx-swap": "innerHTML"
  } do |f| %>
    <%= f.label :code, "Enter the 6-digit code from your app" %>
    <%= f.text_field :code, 
        required: true, 
        autocomplete: "one-time-code",
        inputmode: "numeric",
        pattern: "[0-9]{6}",
        maxlength: 6,
        placeholder: "000000",
        autofocus: true %>

    <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
      <%= f.submit "Verify & Enable" %>
      <button type="button" 
              class="secondary"
              hx-delete="<%= identity_totp_path(@totp) %>"
              hx-target="#totp-container"
              hx-swap="innerHTML"
              hx-confirm="Cancel 2FA setup?">
        Cancel
      </button>
    </div>
  <% end %>
</div>
